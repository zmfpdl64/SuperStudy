CREATE DATABASE chapter_77;
USE chapter_77;

CREATE TABLE group_singer (
  mem_id CHAR(8) NOT NULL PRIMARY KEY, -- 가수 ID
  mem_name VARCHAR(10) NOT NULL, -- 이름
  mem_number INT NOT NULL, -- 인원 수 
  addr 	VARCHAR(2) NOT NULL, -- 주소(경기, 서울, 경남 식으로 2글자 입력)
  phone	VARCHAR(11), -- 전화번호 (하이픈 제외)
  height SMALLINT, -- 평균 키
  debut_date DATE -- 데뷔
);
SELECT g.mem_name, b.prod_name, SUM(b.amount) AS 최대_수량
FROM group_singer g
INNER JOIN buy_history b ON g.mem_id = b.mem_id
WHERE g.addr = '경기'
GROUP BY g.mem_name, b.prod_name
ORDER BY SUM(b.amount) DESC
LIMIT 1;

select g.mem_name, b.prod_name, COALESCE(b.amount, 0) as '수량'
from group_singer g
left join buy_history b on b.mem_id = g.mem_id
order by g.mem_name asc, b.amount asc;


select * from buy_history b;

CREATE TABLE buy_history (
	buy_id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, -- 순번(PK)
	mem_id CHAR(8) NOT NULL, -- 아이디(FK)
    prod_name CHAR(6) NOT NULL, -- 제품 이름
    group_name CHAR(4), -- 분류
    price INT NOT NULL, -- 단가
    amount SMALLINT NOT NULL, -- 수량
    FOREIGN KEY (mem_id) REFERENCES group_singer(mem_id)
);

INSERT INTO group_singer (mem_id, mem_name, mem_number, addr, phone, height, debut_date)
VALUES
    -- 서울
    ('mem001', '방탄소년단', 7, '서울', '01012345678', 178, '2013-06-13'),
    ('mem002', 'EXO', 9, '서울', '01023456789', 183, '2012-04-08'),
    ('mem004', '블랙핑크', 4, '서울', '01045678901', 165, '2016-08-08'),
    ('mem005', '뉴이스트', 5, '서울', '01056789012', 177, '2012-03-15'),
    ('mem006', '위너', 4, '서울', '01067890123', 180, '2014-08-12'),
    ('mem007', '레드벨벳', 5, '서울', '01078901234', 160, '2014-08-01'),
    ('mem008', '세븐틴', 13, '서울', '01089012345', 175, '2015-05-26'),
    ('mem009', '아이유', 1, '서울', '01090123456', 162, '2008-09-18'),
    ('mem011', '갓세븐', 7, '서울', '01012345678', 178, '2014-01-20'),
    ('mem012', '비투비', 7, '서울', '01023456789', 180, '2012-03-21'),
    ('mem013', '에이핑크', 6, '서울', '01034567890', 165, '2011-04-19'),
    ('mem015', '모모랜드', 9, '서울', '01056789012', 167, '2016-11-10'),
    ('mem016', '엑소', 9, '서울', '01067890123', 183, '2012-04-08'),
    ('mem017', '있지', 5, '서울', '01078901234', 165, '2019-02-12'),
    ('mem019', 'TXT', 5, '서울', '01090123456', 179, '2019-03-04'),
    ('mem020', 'NCT', 23, '서울', '01001234567', 176, '2016-04-09'),
    ('mem021', '오마이걸', 7, '서울', '01012345678', 165, '2015-04-20'),
    ('mem022', '스트레이 키즈', 8, '서울', '01023456789', 172, '2018-03-26'),
    ('mem023', '에버글로우', 6, '서울', '01034567890', 168, '2019-03-18'),
    ('mem025', '소녀시대', 8, '서울', '01056789012', 165, '2007-08-05'),
    ('mem026', '워너원', 11, '서울', '01067890123', 174, '2017-08-07'),
    ('mem027', '오마이걸', 7, '서울', '01078901234', 165, '2015-04-20'),
    ('mem029', '몬스타엑스', 7, '서울', '01090123456', 181, '2015-05-14'),

    -- 경기
    ('mem003', '트와이스', 9, '경기', '01034567890', 163, '2015-10-20'),
    ('mem010', '마마무', 4, '경기', '01001234567', 162, '2014-06-18'),
    ('mem018', 'ITZY', 5, '경기', '01089012345', 166, '2019-02-12'),

    -- 경상도
    ('mem014', '세븐', 1, '경남', '01098765432', 178, '2003-03-08'),

    -- 전라도
    ('mem024', '박진영', 1, '전남', '01087654321', 180, '1992-09-24'),

    -- 충청도
    ('mem028', '트레저', 12, '충북', '01076543210', 176, '2020-08-07');
    
    
    INSERT INTO buy_history (mem_id, prod_name, group_name, price, amount)
VALUES
    ('mem001', '아메리카노', '음료', 2500, 2),
    ('mem001', '샌드위치', '식품', 3500, 1),
    ('mem002', '요구르트', '음료', 1500, 3),
    ('mem002', '샐러드', '식품', 5000, 1),
    ('mem003', '핫도그', '식품', 2500, 2),
    ('mem003', '아이스크림', '간식', 2000, 3),
    ('mem004', '커피', '음료', 3000, 2),
    ('mem004', '과자', '간식', 2000, 4),
    ('mem005', '스포츠 음료', '음료', 3500, 1),
    ('mem005', '새우깡', '간식', 1500, 2),
    ('mem006', '콜라', '음료', 2000, 2),
    ('mem006', '떡볶이', '식품', 3000, 1),
    ('mem007', '사이다', '음료', 1800, 4),
    ('mem007', '과일', '식품', 4000, 1),
    ('mem008', '커피라떼', '음료', 3000, 3),
    ('mem008', '감자칩', '간식', 2500, 2),
    ('mem009', '차', '음료', 1500, 1),
    ('mem009', '파이', '간식', 3000, 1),
    ('mem010', '코코아', '음료', 2000, 2),
    ('mem010', '새우튀김', '간식', 3500, 3),
    ('mem011', '햄버거', '음식', 5000, 1),
    ('mem011', '피자', '음식', 6000, 2),
    ('mem012', '샌드위치', '식품', 3500, 1),
    ('mem012', '과일 주스', '음료', 3000, 3),
    ('mem013', '과자', '간식', 2000, 2),
    ('mem013', '커피젤리', '간식', 2500, 1),
    ('mem014', '라면', '식품', 2500, 3),
    ('mem014', '스포츠 음료', '음료', 3500, 2),
    ('mem015', '과일', '식품', 4000, 1),
    ('mem015', '아이스크림', '간식', 2000, 4),
        ('mem001', '아메리카노', '음료', 2500, 2),
    ('mem001', '샌드위치', '식품', 3500, 1),
    ('mem002', '요구르트', '음료', 1500, 3),
    ('mem002', '샐러드', '식품', 5000, 1),
    ('mem003', '핫도그', '식품', 2500, 2),
    ('mem003', '아이스크림', '간식', 2000, 3),
    ('mem004', '커피', '음료', 3000, 2),
    ('mem004', '과자', '간식', 2000, 4),
    ('mem005', '스포츠 음료', '음료', 3500, 1),
    ('mem005', '새우깡', '간식', 1500, 2),
    ('mem006', '콜라', '음료', 2000, 2),
    ('mem006', '떡볶이', '식품', 3000, 1),
    ('mem007', '사이다', '음료', 1800, 4),
    ('mem007', '과일', '식품', 4000, 1),
    ('mem008', '커피라떼', '음료', 3000, 3),
    ('mem008', '감자칩', '간식', 2500, 2),
    ('mem009', '차', '음료', 1500, 1),
    ('mem009', '파이', '간식', 3000, 1),
    ('mem010', '코코아', '음료', 2000, 2),
    ('mem010', '새우튀김', '간식', 3500, 3),
    ('mem011', '햄버거', '음식', 5000, 1),
    ('mem011', '피자', '음식', 6000, 2),
    ('mem012', '샌드위치', '식품', 3500, 1),
    ('mem012', '과일 주스', '음료', 3000, 3),
    ('mem013', '과자', '간식', 2000, 2),
    ('mem013', '커피젤리', '간식', 2500, 1),
    ('mem014', '라면', '식품', 2500, 3),
    ('mem014', '스포츠 음료', '음료', 3500, 2),
    ('mem015', '과일', '식품', 4000, 1),
    ('mem015', '아이스크림', '간식', 2000, 4);